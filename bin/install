#!/usr/bin/env sh
set -e

# TODO: The {{}} syntax doesn't work in rails 2.3
cat > config/database.yml <<\EOF
production:
  adapter: postgresql
  database: "{{DB_NAME}}"
  host: "{{DB_HOST}}"
  username: "{{DB_USER}}"
  password: "{{DB_PASS}}"
  encoding: unicode
  pool: 5
EOF

bundle install --binstubs --without development test mysql2 mysql ldap openid sqlite

chown -R nobody:nogroup /app

# TODO: Handle db schema updates somehow; working with existing datasets
